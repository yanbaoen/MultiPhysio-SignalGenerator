C51 COMPILER V8.08   TLV5618_HC05_TEST1                                                    01/11/2019 18:21:37 PAGE 1   


C51 COMPILER V8.08, COMPILATION OF MODULE TLV5618_HC05_TEST1
OBJECT MODULE PLACED IN TLV5618+HC05_test1.OBJ
COMPILER INVOKED BY: E:\Program Files (x86)\Keil\C51\BIN\C51.EXE TLV5618+HC05_test1.c BROWSE DEBUG OBJECTEXTEND

line level    source

   1          //=====================================================================
   2          //                    TLV5618 DAè½¬æ¢é©±åŠ¨ç¨‹åº
   3          //ç¡¬ä»¶è¿æ¥: DIN â€”â€”P0^0;  
   4          //          SCLK â€”â€”P0^1;    
   5          //          CS   â€”â€”P0^2;      
   6          //          VDD --é€»è¾‘ç”µæº(+5V)
   7          //          AGND --GND(0V)
   8          
   9          //è¯´æ˜   å‚è€ƒç”µå‹ä¸º0â€”3.5Vï¼Œæœ¬ç¨‹åºä¸º2.5V
  10          //       è¾“å‡ºæ¨¡æ‹Ÿç”µå‹ä¸º:V=2*Vref*(dignum/0x1000) æ³¨:dignumåå››ä½ä¸º:0x0000~~0x0fff
  11          //æ³¨æ„: æ‰€éœ€è¾“å…¥çš„æ•°å­—ä¿¡å·å€¼ä¸º16ä½æ•°,å…¶ä¸­D15~~D12ä¸ºç‰¹æ®Šä½è®¾ç½®,D11~~D0ä¸ºæ•°æ®ä½00
             -0~~fff
  12          
  13          
  14          #include<reg52.h>                                                       //åŒ…å«51å•ç‰‡æœºå¯„å­˜å™¨å®šä¹‰çš„å¤´æ–‡ä»¶
  15          #include<intrins.h>     
  16          #define uint unsigned int
  17          #define uchar unsigned char
  18          #define Channal_A     1    //é€šé“A
  19          #define Channal_B     2    //é€šé“B
  20          #define Channal_AB    3    //é€šé“A&B
  21          //**************************ä¸€ä¸‹ä¸ºå‡½æ•°å£°æ˜ä¿®**************************************
  22          static void DA_conver(uint Dignum);
  23          extern void Write_A_B(uint Data_A,uint Data_B,uchar Channal,bit Model);
  24          void InitUART  (void);
  25          void SendByte(unsigned char dat);
  26          void SendStr(unsigned char *s);
  27          //**************************ä¿®æ”¹ç¡¬ä»¶æ—¶è¦ä¿®æ”¹çš„éƒ¨åˆ†********************************
  28          sbit DIN   = P1^0;     //æ•°æ®è¾“å…¥ç«¯
  29          sbit SCLK = P1^1;     //æ—¶é’Ÿä¿¡å·
  30          sbit CS    = P1^2;     //ç‰‡é€‰è¾“å…¥ç«¯ï¼Œä½ç”µå¹³æœ‰æ•ˆ
  31          //*******************  ä¸²å£åˆå§‹åŒ–*******************
  32          void InitUART  (void)
  33          {
  34   1          SCON  =0x50;       // SCON: æ¨¡å¼ 1, 8-bit UART, ä½¿èƒ½æ¥æ”¶ 
  35   1          TMOD |= 0x20;      // TMOD:timer 1, mode 2, 8-bit é‡è£…
  36   1          TH1 =TL1= 0xFD;   // TH1:  é‡è£…å€¼9600 æ³¢ç‰¹ç‡ æ™¶æŒ¯ 11.0592MHz  
  37   1          TR1   =1;               // TR1: timer 1 æ‰“å¼€                     
  38   1          EA   = 1;              //æ‰“å¼€æ€»ä¸­æ–­
  39   1          ES   = 1;              //æ‰“å¼€ä¸²å£ä¸­æ–­
  40   1      }   
  41          //******************* å‘é€ä¸€ä¸ªå­—èŠ‚ *******************
  42          void SendByte(unsigned char dat)
  43          {
  44   1         SBUF = dat;
  45   1         while(!TI);
  46   1         TI = 0;  
  47   1      }
  48          //**************** å‘é€ä¸€ä¸ªå­—ç¬¦ä¸² *******************
  49          void SendStr(unsigned char *s)
  50          {
  51   1          while(*s!='\0')   // \0è¡¨ç¤ºå­—ç¬¦ä¸²ç»“æŸæ ‡å¿—ï¼Œé€šè¿‡æ£€æµ‹æ˜¯å¦å­—ç¬¦ä¸²æœ«å°¾
  52   1          {
  53   2             SendByte(*s);
  54   2             s++;
C51 COMPILER V8.08   TLV5618_HC05_TEST1                                                    01/11/2019 18:21:37 PAGE 2   

  55   2          }
  56   1      }
  57          //****************** ä¸²å£ä¸­æ–­ç¨‹åº *******************
  58          void UART_SER (void) interrupt 4 
  59          {
  60   1         unsigned char Temp;        
  61   1         if(RI)                           //åˆ¤æ–­æ˜¯æ¥æ”¶ä¸­æ–­äº§ç”Ÿ
  62   1         {
  63   2          RI=0;                      //æ ‡å¿—ä½æ¸…é›¶
  64   2          Temp=SBUF;           //è¯»å…¥ç¼“å†²åŒºçš„å€¼
  65   2          Write_A_B(Temp,0x0000,Channal_A,1);           
  66   2          SendByte(Temp);  //æŠŠæ¥æ”¶åˆ°çš„å€¼å†å‘å›ç”µè„‘ç«¯
  67   2          }
  68   1      }
  69          //=================================================================
  70          // å‡½æ•°åç§° ï¼švoid DA_conver(uint Dignum)
  71          // å‡½æ•°åŠŸèƒ½ ï¼šè¿›è¡ŒDAè½¬æ¢
  72          // å…¥å£å‚æ•° ï¼šDignum:æ ¹æ®è¯´æ˜è®¾ç½®è½¬åŒ–æ•°æ®.å¤´å››ä½ä¸ºç‰¹æ®Šä½ç”¨äºé€‰æ‹©è½¬åŒ–æ–¹å¼,
  73          //            ä»¥åŠç”¨äºé€šé“é€‰æ‹©.è¯·è‡ªè¡Œè®¾ç½®.å12ä½ä¸ºéœ€è¦è½¬æ¢çš„å€¼
  74          // å‡ºå£å‚æ•° ï¼šæ— 
  75          
  76          void DA_conver(uint Dignum)
  77          {
  78   1      uint Dig=0;
  79   1      uchar i=0;
  80   1      SCLK=1;
  81   1      CS=0;           //ç‰‡é€‰æœ‰æ•ˆ
  82   1      for(i=0;i<16;i++)   //å†™å…¥16ä¸ºBitçš„æ§åˆ¶ä½å’Œæ•°æ®
  83   1      {
  84   2         Dig=Dignum&0x8000;
  85   2         if(Dig)
  86   2         {
  87   3          DIN=1;
  88   3         }
  89   2         else
  90   2         {
  91   3          DIN=0;
  92   3         }
  93   2         SCLK=0;
  94   2         _nop_();
  95   2         Dignum<<=1;
  96   2         SCLK=1;
  97   2         _nop_();
  98   2      }
  99   1      SCLK=1;
 100   1      CS=1;       //ç‰‡é€‰æ— æ•ˆ
 101   1      }
 102          //=================================================================
 103          // å‡½æ•°åç§° ï¼švoid Write_A_B(uint Data_A,uint Data_B,uchar Channal,bit Model)
 104          // å‡½æ•°åŠŸèƒ½ ï¼šæ¨¡å¼ã€é€šé“é€‰æ‹©å¹¶è¿›è¡ŒDAè½¬æ¢
 105          // å…¥å£å‚æ•° ï¼šData_Aï¼šAé€šé“è½¬æ¢çš„ç”µå‹å€¼
 106          //            Data_Bï¼šBé€šé“è½¬æ¢çš„ç”µå‹å€¼
 107          //            Channalï¼šé€šé“é€‰æ‹©ï¼Œå…¶å€¼ä¸ºChannal_Aï¼ŒChannal_B,æˆ–Channal_AB
 108          //            Modelï¼šé€Ÿåº¦æ§åˆ¶ä½ 0ï¼šslow mode 1ï¼šfast mode
 109          // å‡ºå£å‚æ•° ï¼šæ— 
 110          // è¯´æ˜ï¼š     Data_Aï¼ŒData_Bçš„èŒƒå›´ä¸ºï¼š0â€”0x0fff
 111          //            æœ¬ç¨‹åºå¦‚æœåªéœ€è¦ä¸€ä¸ªé€šé“æ—¶ï¼Œå¦å¤–ä¸€ä¸ªé€šé“çš„å€¼å¯ä»»æ„ï¼Œä½†æ˜¯ä¸èƒ½ç¼
             -ºçœ
 112          //=================================================================
 113          void Write_A_B(uint Data_A,uint Data_B,uchar Channal,bit Model)
 114          {
 115   1      uint Temp;
C51 COMPILER V8.08   TLV5618_HC05_TEST1                                                    01/11/2019 18:21:37 PAGE 3   

 116   1      if(Model)
 117   1      {
 118   2         Temp=0x4000;
 119   2      }
 120   1      else
 121   1          {
 122   2         Temp=0x0000;
 123   2      }
 124   1      switch(Channal)
 125   1      {
 126   2          case Channal_A:         //Aé€šé“
 127   2               DA_conver(Temp|0x8000|(0x0fff&Data_A));
 128   2            break;
 129   2          case Channal_B:       //Bé€šé“
 130   2               DA_conver(Temp|0x0000|(0x0fff&Data_B));
 131   2          break;
 132   2          case Channal_AB:
 133   2               DA_conver(Temp|0x1000|(0x0fff&Data_B));        //A&Bé€šé“
 134   2               DA_conver(Temp|0x8000|(0x0fff&Data_A));
 135   2          break;
 136   2          default:
 137   2               break;
 138   2      }
 139   1      }
 140          
 141          int main(void)
 142          {
 143   1              InitUART();
 144   1          while(1);
 145   1         
 146   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    265    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----       5
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----       1
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
