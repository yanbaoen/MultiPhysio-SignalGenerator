C51 COMPILER V8.08   TLV5618_HC05_TEST2                                                    10/27/2018 14:51:41 PAGE 1   


C51 COMPILER V8.08, COMPILATION OF MODULE TLV5618_HC05_TEST2
OBJECT MODULE PLACED IN TLV5618+HC05_test2.OBJ
COMPILER INVOKED BY: E:\Program Files (x86)\Keil\C51\BIN\C51.EXE TLV5618+HC05_test2.c BROWSE DEBUG OBJECTEXTEND

line level    source

   1          //=====================================================================
   2          //                    TLV5618 DAè½¬æ¢é©±åŠ¨ç¨‹åº
   3          //ç¡¬ä»¶è¿æ¥: DIN â€”â€”P0^0;  
   4          //          SCLK â€”â€”P0^1;    
   5          //          CS   â€”â€”P0^2;      
   6          //          VDD --é€»è¾‘ç”µæº(+5V)
   7          //          AGND --GND(0V)
   8          
   9          //è¯´æ˜   å‚è€ƒç”µå‹ä¸º0â€”3.5Vï¼Œæœ¬ç¨‹åºä¸º2.5V
  10          //       è¾“å‡ºæ¨¡æ‹Ÿç”µå‹ä¸º:V=2*Vref*(dignum/0x1000) æ³¨:dignumåå››ä½ä¸º:0x0000~~0x0fff
  11          //æ³¨æ„: æ‰€éœ€è¾“å…¥çš„æ•°å­—ä¿¡å·å€¼ä¸º16ä½æ•°,å…¶ä¸­D15~~D12ä¸ºç‰¹æ®Šä½è®¾ç½®,D11~~D0ä¸ºæ•°æ®ä½00
             -0~~fff
  12          
  13          
  14          #include<reg52.h>                                                       //åŒ…å«51å•ç‰‡æœºå¯„å­˜å™¨å®šä¹‰çš„å¤´æ–‡ä»¶
  15          #include<intrins.h>     
  16          #define uint unsigned int
  17          #define uchar unsigned char
  18          #define Channal_A     1    //é€šé“A
  19          #define Channal_B     2    //é€šé“B
  20          #define Channal_AB    3    //é€šé“A&B
  21          //**************************ä¸€ä¸‹ä¸ºå‡½æ•°å£°æ˜ä¿®**************************************
  22          static void DA_conver(uint Dignum);
  23          extern void Write_A_B(uint Data_A,uint Data_B,uchar Channal,bit Model);
  24          void InitUART  (void);
  25          void SendByte(unsigned char dat);
  26          void SendStr(unsigned char *s);
  27          //**************************ä¿®æ”¹ç¡¬ä»¶æ—¶è¦ä¿®æ”¹çš„éƒ¨åˆ†********************************
  28          sbit DIN   = P1^0;     //æ•°æ®è¾“å…¥ç«¯
  29          sbit SCLK = P1^1;     //æ—¶é’Ÿä¿¡å·
  30          sbit CS    = P1^2;     //ç‰‡é€‰è¾“å…¥ç«¯ï¼Œä½ç”µå¹³æœ‰æ•ˆ
  31          uchar AABB[2] = {0x00,0x00};
  32          int iii = 0; 
  33          //*******************  ä¸²å£åˆå§‹åŒ–*******************
  34          void InitUART  (void)
  35          {
  36   1          SCON  =0x50;       // SCON: æ¨¡å¼ 1, 8-bit UART, ä½¿èƒ½æ¥æ”¶ 
  37   1          TMOD |= 0x20;      // TMOD:timer 1, mode 2, 8-bit é‡è£…
  38   1          TH1 =TL1= 0xFD;   // TH1:  é‡è£…å€¼9600 æ³¢ç‰¹ç‡ æ™¶æŒ¯ 11.0592MHz  
  39   1          TR1   =1;               // TR1: timer 1 æ‰“å¼€                     
  40   1          EA   = 1;              //æ‰“å¼€æ€»ä¸­æ–­
  41   1          ES   = 1;              //æ‰“å¼€ä¸²å£ä¸­æ–­
  42   1      }   
  43          //******************* å‘é€ä¸€ä¸ªå­—èŠ‚ *******************
  44          void SendByte(unsigned char dat)
  45          {
  46   1         SBUF = dat;
  47   1         while(!TI);
  48   1         TI = 0;  
  49   1      }
  50          //**************** å‘é€ä¸€ä¸ªå­—ç¬¦ä¸² *******************
  51          void SendStr(unsigned char *s)
  52          {
  53   1          while(*s!='\0')   // \0è¡¨ç¤ºå­—ç¬¦ä¸²ç»“æŸæ ‡å¿—ï¼Œé€šè¿‡æ£€æµ‹æ˜¯å¦å­—ç¬¦ä¸²æœ«å°¾
  54   1          {
C51 COMPILER V8.08   TLV5618_HC05_TEST2                                                    10/27/2018 14:51:41 PAGE 2   

  55   2             SendByte(*s);
  56   2             s++;
  57   2          }
  58   1      }
  59          //****************** ä¸²å£ä¸­æ–­ç¨‹åº *******************
  60          void UART_SER (void) interrupt 4 
  61          {
  62   1         unsigned char Temp; 
  63   1               
  64   1         if(RI)                           //åˆ¤æ–­æ˜¯æ¥æ”¶ä¸­æ–­äº§ç”Ÿ
  65   1         {
  66   2          RI=0;//æ ‡å¿—ä½æ¸…é›¶
  67   2                               
  68   2          Temp=SBUF;           //è¯»å…¥ç¼“å†²åŒºçš„å€¼
  69   2          AABB[iii] = Temp;
  70   2          iii = 0;
  71   2          if(AABB[0] == 0xFF)
  72   2          {
  73   3              iii = 1;
  74   3              AABB[0] = 0x00;
  75   3          }
  76   2          
  77   2              
  78   2          Write_A_B(AABB[0],AABB[1],Channal_AB,0);           
  79   2          SendByte(Temp);  //æŠŠæ¥æ”¶åˆ°çš„å€¼å†å‘å›ç”µè„‘ç«¯
  80   2              
  81   2          }
  82   1      }
  83          //=================================================================
  84          // å‡½æ•°åç§° ï¼švoid DA_conver(uint Dignum)
  85          // å‡½æ•°åŠŸèƒ½ ï¼šè¿›è¡ŒDAè½¬æ¢
  86          // å…¥å£å‚æ•° ï¼šDignum:æ ¹æ®è¯´æ˜è®¾ç½®è½¬åŒ–æ•°æ®.å¤´å››ä½ä¸ºç‰¹æ®Šä½ç”¨äºé€‰æ‹©è½¬åŒ–æ–¹å¼,
  87          //            ä»¥åŠç”¨äºé€šé“é€‰æ‹©.è¯·è‡ªè¡Œè®¾ç½®.å12ä½ä¸ºéœ€è¦è½¬æ¢çš„å€¼
  88          // å‡ºå£å‚æ•° ï¼šæ— 
  89          
  90          void DA_conver(uint Dignum)
  91          {
  92   1      uint Dig=0;
  93   1      uchar i=0;
  94   1      SCLK=1;
  95   1      CS=0;           //ç‰‡é€‰æœ‰æ•ˆ
  96   1      for(i=0;i<16;i++)   //å†™å…¥16ä¸ºBitçš„æ§åˆ¶ä½å’Œæ•°æ®
  97   1      {
  98   2         Dig=Dignum&0x8000;
  99   2         if(Dig)
 100   2         {
 101   3          DIN=1;
 102   3         }
 103   2         else
 104   2         {
 105   3          DIN=0;
 106   3         }
 107   2         SCLK=0;
 108   2         _nop_();
 109   2         Dignum<<=1;
 110   2         SCLK=1;
 111   2         _nop_();
 112   2      }
 113   1      SCLK=1;
 114   1      CS=1;       //ç‰‡é€‰æ— æ•ˆ
 115   1      }
 116          //=================================================================
C51 COMPILER V8.08   TLV5618_HC05_TEST2                                                    10/27/2018 14:51:41 PAGE 3   

 117          // å‡½æ•°åç§° ï¼švoid Write_A_B(uint Data_A,uint Data_B,uchar Channal,bit Model)
 118          // å‡½æ•°åŠŸèƒ½ ï¼šæ¨¡å¼ã€é€šé“é€‰æ‹©å¹¶è¿›è¡ŒDAè½¬æ¢
 119          // å…¥å£å‚æ•° ï¼šData_Aï¼šAé€šé“è½¬æ¢çš„ç”µå‹å€¼
 120          //            Data_Bï¼šBé€šé“è½¬æ¢çš„ç”µå‹å€¼
 121          //            Channalï¼šé€šé“é€‰æ‹©ï¼Œå…¶å€¼ä¸ºChannal_Aï¼ŒChannal_B,æˆ–Channal_AB
 122          //            Modelï¼šé€Ÿåº¦æ§åˆ¶ä½ 0ï¼šslow mode 1ï¼šfast mode
 123          // å‡ºå£å‚æ•° ï¼šæ— 
 124          // è¯´æ˜ï¼š     Data_Aï¼ŒData_Bçš„èŒƒå›´ä¸ºï¼š0â€”0x0fff
 125          //            æœ¬ç¨‹åºå¦‚æœåªéœ€è¦ä¸€ä¸ªé€šé“æ—¶ï¼Œå¦å¤–ä¸€ä¸ªé€šé“çš„å€¼å¯ä»»æ„ï¼Œä½†æ˜¯ä¸èƒ½ç¼
             -ºçœ
 126          //=================================================================
 127          void Write_A_B(uint Data_A,uint Data_B,uchar Channal,bit Model)
 128          {
 129   1      uint Temp;
 130   1      if(Model)
 131   1      {
 132   2         Temp=0x4000;
 133   2      }
 134   1      else
 135   1          {
 136   2         Temp=0x0000;
 137   2      }
 138   1      switch(Channal)
 139   1      {
 140   2          case Channal_A:         //Aé€šé“
 141   2               DA_conver(Temp|0x8000|(0x0fff&Data_A));
 142   2            break;
 143   2          case Channal_B:       //Bé€šé“
 144   2               DA_conver(Temp|0x0000|(0x0fff&Data_B));
 145   2          break;
 146   2          case Channal_AB:
 147   2               DA_conver(Temp|0x1000|(0x0fff&Data_B));        //A&Bé€šé“
 148   2               DA_conver(Temp|0x8000|(0x0fff&Data_A));
 149   2          break;
 150   2          default:
 151   2               break;
 152   2      }
 153   1      }
 154          
 155          int main(void)
 156          {
 157   1              InitUART();
 158   1          while(1);
 159   1         
 160   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    293    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      4       5
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----       1
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
